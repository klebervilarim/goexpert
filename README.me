CEP Weather API â€” Cloud Run em Go

API em Go (Golang) que recebe um CEP de 8 dÃ­gitos, identifica a cidade via ViaCEP
 e retorna o clima atual dessa localidade utilizando a WeatherAPI
.

ğŸš€ Funcionalidades

Recebe um CEP (8 dÃ­gitos) no formato GET /weather?cep=<cep>

Busca cidade e UF via ViaCEP

Consulta a temperatura via WeatherAPI

Retorna a resposta formatada em:

Celsius (Â°C)

Fahrenheit (Â°F)

Kelvin (K)

CÃ³digos HTTP tratados:

âœ… 200 â€” Sucesso

âš ï¸ 404 â€” CEP nÃ£o encontrado

âŒ 422 â€” CEP invÃ¡lido

ğŸ§© Estrutura do projeto
cloudrun/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ httpapi/
â”‚   â”‚   â””â”€â”€ server.go
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ viacep.go
â”‚   â”‚   â””â”€â”€ weatherapi.go
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ convert.go
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ server_test.go
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Makefile
â”œâ”€â”€ go.mod
â””â”€â”€ README.md

âš™ï¸ VariÃ¡veis de ambiente

Crie um arquivo .env com o conteÃºdo:

WEATHERAPI_KEY=SUA_CHAVE_WEATHERAPI
VIACEP_BASE=https://viacep.com.br
WEATHERAPI_BASE=https://api.weatherapi.com
PORT=8080

ğŸ§° ExecuÃ§Ã£o local
ğŸ”¹ Usando Go diretamente
export WEATHERAPI_KEY="SUA_CHAVE_WEATHERAPI"
go run ./cmd/api


Servidor iniciarÃ¡ em:
ğŸ‘‰ http://localhost:8080

ğŸ”¹ Usando Docker Compose
docker compose up --build


Acesse:
ğŸ‘‰ http://localhost:8080

ğŸ§ª Testes de API
âœ… Verificar se o servidor estÃ¡ rodando
curl http://localhost:8080/healthz


Resposta esperada:

ok

ğŸŒ¡ï¸ Buscar temperatura por CEP vÃ¡lido
curl "http://localhost:8080/weather?cep=05372100"


Exemplo de resposta:

{
  "temp_C": 27.5,
  "temp_F": 81.5,
  "temp_K": 300.0
}

âš ï¸ CEP invÃ¡lido
curl -i "http://localhost:8080/weather?cep=010225"


Resposta:

HTTP/1.1 422 Unprocessable Entity
invalid zipcode

âŒ CEP inexistente
curl -i "http://localhost:8080/weather?cep=99999999"


Resposta:

HTTP/1.1 404 Not Found
can not find zipcode

ğŸ§± Build com Makefile
make build    # Gera binÃ¡rio local (bin/api)
make run      # Executa localmente na porta 8080
make test     # Roda testes automatizados


â˜ï¸ Deploy no Google Cloud Run
gcloud builds submit --tag gcr.io/$(gcloud config get-value project)/cloudrun
gcloud run deploy cloudrun \
  --image gcr.io/$(gcloud config get-value project)/cloudrun \
  --platform managed \
  --region southamerica-east1 \
  --allow-unauthenticated \
  --set-env-vars "WEATHERAPI_KEY=SUA_CHAVE_WEATHERAPI"

ğŸ“Œ Endpoints
MÃ©todo	Rota	DescriÃ§Ã£o
GET	/healthz	Checa status da aplicaÃ§Ã£o
GET	/weather?cep={CEP}	Retorna temperaturas (C/F/K)
ğŸ§  Exemplo completo de execuÃ§Ã£o
$ export WEATHERAPI_KEY="ec799e849f9744f2b9a203358251010"
$ make run
ğŸš€ Iniciando servidor local na porta 8080...
2025/10/08 ğŸš€ Server running on :8080

# Em outro terminal:
curl "http://localhost:8080/weather?cep=01001000"


SaÃ­da esperada:

{
  "temp_C": 28.5,
  "temp_F": 83.3,
  "temp_K": 301.5
}


Executar via cloudrun

ğŸš€ URL PÃºblica do ServiÃ§o

ğŸŒ https://cloudrun-cep-403358086773.southamerica-east1.run.app

ğŸ§© Endpoints
MÃ©todo	Rota	DescriÃ§Ã£o
GET	/healthz	Verifica se o serviÃ§o estÃ¡ ativo
GET	/weather?cep={CEP}	Retorna temperatura em Celsius, Fahrenheit e Kelvin
ğŸ’¡ Exemplos de Uso
âœ… 1ï¸âƒ£ Health Check

Verifica se a API estÃ¡ no ar:

curl https://cloudrun-cep-403358086773.southamerica-east1.run.app/healthz


Resposta esperada:

ok

ğŸŒ¡ï¸ 2ï¸âƒ£ Consulta de CEP vÃ¡lido

Exemplo com o CEP da SÃ© (SÃ£o Paulo):

curl "https://cloudrun-cep-403358086773.southamerica-east1.run.app/weather?cep=01001000"


Resposta esperada:

{
  "temp_C": 27.8,
  "temp_F": 82.0,
  "temp_K": 300.8
}

âš ï¸ 3ï¸âƒ£ CEP invÃ¡lido
curl -i "https://cloudrun-cep-403358086773.southamerica-east1.run.app/weather?cep=123"


Resposta:

HTTP/2 422
invalid zipcode

âŒ 4ï¸âƒ£ CEP inexistente
curl -i "https://cloudrun-cep-403358086773.southamerica-east1.run.app/weather?cep=99999999"


Resposta:

HTTP/2 404
can not find zipcode


ğŸ§± Build e Deploy no Cloud Run
1ï¸âƒ£ Build da imagem
gcloud builds submit . \
  --tag gcr.io/mba-golang/cloudrun-cep \
  --project=mba-golang

2ï¸âƒ£ Deploy no Cloud Run
gcloud run deploy cloudrun-cep \
  --image gcr.io/mba-golang/cloudrun-cep \
  --platform managed \
  --region southamerica-east1 \
  --allow-unauthenticated \
  --project=mba-golang \
  --set-env-vars "WEATHERAPI_KEY=ec799e849f9744f2b9a203358251010,VIACEP_BASE=https://viacep.com.br,WEATHERAPI_BASE=https://api.weatherapi.com"

ğŸ§  Como funciona

Recebe o CEP (/weather?cep=01001000)

Usa a API ViaCEP para identificar a cidade e UF

Consulta a WeatherAPI usando o nome da cidade

Retorna as temperaturas convertidas:

Â°C: temperatura original da API

Â°F: C * 1.8 + 32

K: C + 273